--- server.py
+++ server.py
@@ -289,10 +289,13 @@
         await state_manager.connect_admin(websocket)
         try:
             while True:
-                data = await websocket.receive_json()
-                await handle_admin_command(data)
-                
-        except WebSocketDisconnect:
+                try:
+                    data = await websocket.receive_json()
+                    await handle_admin_command(data)
+                except Exception as e:
+                    logger.error(f"处理管理端消息时出错: {e}")
+                    
+        except (WebSocketDisconnect, ConnectionClosedError):
             state_manager.disconnect_admin(websocket)
             logger.info("管理端WebSocket连接断开")
         except Exception as e:
@@ -330,7 +333,8 @@
     elif command_type == "play_music":
         state_manager.is_playing = True
         await state_manager.broadcast_to_display(ControlCommand(
-            type="play"
+            type="play",
+            data={"time": state_manager.current_time}
         ))
         await state_manager.broadcast_to_admin(ControlCommand(
             type="state_update",
@@ -340,6 +344,9 @@
         ))
         
     elif command_type == "pause_music":
+        # 暂停时保存当前时间
+        state_manager.current_time = command_data.get("time", state_manager.current_time)
+        
         state_manager.is_playing = False
         await state_manager.broadcast_to_display(ControlCommand(
             type="pause"
@@ -360,14 +367,15 @@
             await state_manager.broadcast_to_display(ControlCommand(
                 type="track_change",
                 data={
-                    "track": state_manager.current_track.dict(),
-                    "play": True
+                    "track": state_manager.current_track.dict()
                 }
             ))
             
             await state_manager.broadcast_to_admin(ControlCommand(
                 type="state_update",
                 data={
+                    "mode": "music",  # 确保模式正确
+                    "is_playing": True,
                     "current_track_index": state_manager.current_track_index,
                     "current_track": state_manager.current_track.dict(),
                     "is_playing": True
@@ -387,14 +395,15 @@
             await state_manager.broadcast_to_display(ControlCommand(
                 type="track_change",
                 data={
-                    "track": state_manager.current_track.dict(),
-                    "play": True
+                    "track": state_manager.current_track.dict()
                 }
             ))
             
             await state_manager.broadcast_to_admin(ControlCommand(
                 type="state_update",
                 data={
+                    "mode": "music",
+                    "is_playing": True,
                     "current_track_index": state_manager.current_track_index,
                     "current_track": state_manager.current_track.dict(),
                     "is_playing": True
@@ -408,23 +417,23 @@
             state_manager.current_track_index = index
             state_manager.current_track = state_manager.playlist[index]
             state_manager.is_playing = True
-            state_manager.current_time = 0  # 选择新曲目时重置时间
+            state_manager.current_time = 0  # 选择新曲目时从头开始
 
             await state_manager.broadcast_to_display(ControlCommand(
                 type="track_change",
                 data={
-                    "track": state_manager.current_track.dict(),
-                    "play": True,
-                    "time": 0  # 重置时间
+                    "track": state_manager.current_track.dict()
                 }
             ))
 
             await state_manager.broadcast_to_admin(ControlCommand(
                 type="state_update",
                 data={
+                    "mode": "music",
+                    "is_playing": True,
                     "current_track_index": state_manager.current_track_index,
                     "current_track": state_manager.current_track.dict(),
-                    "is_playing": True,
+                    "current_time": 0,  # 重置时间
                     "current_time": 0  # 重置时间
                 }
             ))
@@ -432,17 +441,17 @@
     elif command_type == "seek_music":
         time = command_data.get("time", 0)
         state_manager.current_time = time
         state_manager.is_playing = command_data.get("is_playing", state_manager.is_playing)
         
         # 先发送跳转命令
         await state_manager.broadcast_to_display(ControlCommand(
             type="seek",
             data={"time": time}
         ))
         
         # 然后如果需要，发送播放命令（带上时间）
         if state_manager.is_playing:
             await state_manager.broadcast_to_display(ControlCommand(
-                type="seek",
-                data={"time": time}
+                type="play",
+                data={"time": time}
             ))
@@ -462,13 +471,12 @@
                 type="switch_to_music",
                 data={
                     "track": state_manager.current_track.dict() if state_manager.current_track else None,
-                    "is_playing": state_manager.is_playing,
-                    "current_time": state_manager.current_time
+                    "is_playing": state_manager.is_playing
                 }
             ))
         else:
             await state_manager.broadcast_to_display(ControlCommand(
                 type="switch_to_slide",
-                data={"slide": state_manager.current_slide.dict() if state_manager.current_slide else None}
                 data={
                     "slide": state_manager.current_slide.dict() if state_manager.current_slide else None
                 }
             ))
@@ -494,6 +502,23 @@
                 type="state_update",
                 data={
                     "current_slide_index": state_manager.current_slide_index,
+                    "current_slide": state_manager.current_slide.dict() if state_manager.current_slide else None
                 }
             ))

# WebSocket连接 - 显示端
@app.websocket("/ws/display")
async def websocket_display(websocket: WebSocket):
    await state_manager.connect_display(websocket)
    try:
        while True:
            try:
                data = await websocket.receive_json()
                # 处理显示端的时间更新
                if data.get("type") == "time_update":
                    state_manager.current_time = data.get("data", {}).get("time", 0)
                    # 广播给所有管理端
                    await state_manager.broadcast_to_admin(ControlCommand(
                        type="time_update",
                        data={"time": state_manager.current_time}
                    ))
                    
            except Exception as e:
                logger.error(f"处理显示端消息时出错: {e}")
                
    except (WebSocketDisconnect, ConnectionClosedError):
        state_manager.disconnect_display(websocket)
        logger.info("显示端WebSocket连接断开")
    except Exception as e:
        logger.error(f"处理显示端连接时出错: {e}")
        state_manager.disconnect_display(websocket)